<!DOCTYPE html>
<html>
  <head>
    <title>An R Engine for Real-Time Sports Analytics</title>
    <meta charset="utf-8">
    <meta name="author" content="Stephanie Kovalchik" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="duke_color_pallettes_slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# An R Engine for Real-Time Sports Analytics
### Stephanie Kovalchik
### satRday 2018, Cape Town

---






# About Me

- Senior Data Scientist for Tennis Australia's Game Insight Group

- Research Fellow at Victoria University

- Tennis Blogger at [on-the-t.com](on-the-t.com)

- @StatsOnTheT

---


.pull-left[
&lt;img src="billy-beane-007.jpg" width=100% style="margin-top:25%;" /&gt;
]

&lt;!-- https://www.cbssports.com/mlb/news/athletics-gm-billy-beane-named-mlb-executive-of-the-year/ --&gt;

.pull-right[
&lt;img src="moneyball.jpg" width=80% /&gt;
]


---

&lt;div style="margin-left:5%;margin-top:10%;"&gt;
&lt;img src="sports_trends.png" width=100% /&gt;
&lt;/div&gt;


---

&lt;div style="margin-left: 5%;margin-top: 10%;"&gt;
&lt;img src="sloan_crowd.png" width=100% /&gt;
&lt;p width=60%&gt;Source: 2018 MIT Sloan Sports Analytics Conference&lt;/p&gt;
&lt;/div&gt;

---


.hbox[
## Tennis Analytics
]

---

&lt;div style="margin-left: 15%;margin-top: 2%;"&gt;
&lt;img src="SloanTennisPanel.png" width=75% /&gt;
&lt;p width=60%&gt;Source: 2012 MIT Sloan Sports Analytics Conference&lt;/p&gt;
&lt;/div&gt;


---

.pull-left[
&lt;img src="tiley.jpeg" width=100% style="margin-left:2%; margin-top:25%;" /&gt;
]

.pull-right[
&lt;img src="thin_edge.jpg" width=100% style="margin-top:25%;" /&gt;
Source: 2016 MIT Sloan Sports Analytics Conference
]

---

&lt;div style="margin-left:25%; margin-top:15%;"&gt;
&lt;img src="gig-logo.png" width=50% /&gt;
&lt;/div&gt;

---

# GIG Mission

.cbox[
## Revolutionise tennis through data science.
]


---

.hbox[
## GIG Data
]

---

# Data Sources

.pull-left[
&lt;img src="web.png" width=70% style="margin-left:5%;margin-top:0%;" /&gt;
]

.pull-right[
&lt;img src="camera.png" width=65% /&gt;
]

---

# Web Data


.pull-left[
&lt;img src="web.png" width=70% style="margin-left:5%;margin-top:0%;" /&gt;
]

.pull-right[
- Shot, point, and match-level performance data

- All pro matches since Open Era

- Automated Web scraping

- Stored in SQL database

- Main sources:
  - flashscore.com
  - tennisabstract.com
]

---

# Web Data


.pull-left[
&lt;img src="web.png" width=70% style="margin-left:5%;margin-top:0%;" /&gt;
]


.pull-right[
&lt;div style="margin-top:25%;"&gt;
&lt;h2&gt;github.com/skoval/deuce&lt;/h2&gt;
&lt;/div&gt;
]

---

# Tracking Data


.pull-left[
&lt;img src="camera.png" width=60% style="margin-top:0%;" /&gt;
]

.pull-right[
&lt;img src="Slide4.png" style="margin-top:5%;" /&gt;
]

---

# Tracking Data


.pull-left[
&lt;img src="camera.png" width=70% style="margin-top:0%;" /&gt;
]

.pull-right[
- Proprietary

- Ball and player trajectories

- Australian Open Series, 2012 to Present

- Real-time collection since 2017

- Stored in SQL database
]

---

.hbox[
## Event Operations
]

---

&lt;div style="margin-left:10%;margin-top:5%;" /&gt;
&lt;img src="halep-win.png" width=90%&gt;
&lt;/div&gt;

---

&lt;div style="margin-left:10%;margin-top:2%;" /&gt;
&lt;img src="fed-work.png" width=90%&gt;
&lt;/div&gt;

---

.pull-left[
&lt;img src="work.jpg" width=90% /&gt;
]

.pull-right[
&lt;img src="work2.jpg" width=90% /&gt;
]

---

&lt;div style="float:center;margin-top:2%;" /&gt;
&lt;img src="heatmap.jpg" width=85%&gt;
&lt;/div&gt;

---

# How We Get There...

&lt;div style="margin-left:10%;margin-top:1%;" /&gt;
&lt;img src="engine.jpg" width=90%&gt;
&lt;/div&gt;

---

# Source XML: What We Get

&lt;div style="float:center;margin-top:1%;" /&gt;
&lt;img src="input_xml.png" width=85%&gt;
&lt;/div&gt;

---

# Stats XML: What We Return

We derive point-level statistics on four dimensions of tennis using our own R package called the `GIGEngine`.

&lt;div style="margin-left:10%; margin-top:1%;" /&gt;
&lt;img src="four_dimensions.jpg" width=75%&gt;
&lt;/div&gt;


---

&lt;h1 style="margin-top:20%;margin-left:20%;"&gt;Demo: Tour GIGEngine&lt;/h1&gt;


---

# Modular Code

--

- You get some idea from the package layout that we break down our processes into small steps

--

- This is a key design principle to our code

--

- You can see this at work even better if we look at the main function that creates our 
XML output

---

[&lt;h1 style="margin-top:20%;margin-left:15%;"&gt;Demo: Generating Output&lt;/h1&gt;](file:///Users/skovalchik/Software/GIGEngine/R/complete_xml.R)

---


[&lt;h1 style="margin-top:20%;margin-left:15%;"&gt;Demo: Wrapper for Automation&lt;/h1&gt;](file:///Users/skovalchik/Software/GIGEngine/R/make_xml.R)

---

# Automation: Rscript

.pull-left[
- Real-time can't happen manually!

- Thankfully, `R` has a number of tools for command-line processing

- `Rscript` is one of these

- It's a linux/unix command to invoke R scripts that comes with base R
]

.pull-right[
![](chimp.gif)
]

---

# Automation: Example


```r
# Run file
library(GIGEngine)

args &lt;- commandArgs(trailingOnly = TRUE)

xml.file &lt;- args[1]
out.file &lt;- args[2]
data.path &lt;- args[3]
match.code &lt;- args[4]

make_xml(
	xml.file = xml.file,
	out.file = out.file,
	data.path = data.path,
	match.code = match.code
)
```

--


```r
Rscript --vanilla run.R &lt;xml.file&gt; &lt;out.path&gt; &lt;storage.path&gt; 
  &lt;matchcode&gt;
```


---


&lt;h1 style="margin-top:20%;margin-left:30%;"&gt;Demo: Automation&lt;/h1&gt;


---

# Delivering Output: Web Service

&lt;div style="float:center;margin-top:0%;" /&gt;
&lt;img src="webservice1.png" width=95%&gt;
&lt;/div&gt;

---

# Output XML

&lt;div style="float:center;margin-top:1%;" /&gt;
&lt;img src="webservice2.png" width=95%&gt;
&lt;/div&gt;

---

[&lt;h1 style="margin-top:20%;margin-left:30%;"&gt;GIG Web Service&lt;/h1&gt;](https://services.tennis.com.au/MatchServices.asmx?op=GetMatchFeed)

---

# Tips: R Software for Real Time

--

- Think modularly!

--

- Profile bottlenecks using `lineprof` package

--

- Embrace the tidyverse

--

- Further optimize with:

  - Fast handling of data.frames (e.g. `datatable`)
  - Parallel processing (`parallel`, `foreach`, etc.)
  - Write bottlenecks in C++ and use in R through `Rcpp`

---

# GIG Reports

&lt;div style="float:center;margin-top:1%;" /&gt;
&lt;img src="report.png" width=75%&gt;
&lt;/div&gt;

[Full Report](file:///Users/skovalchik/Software/GIGEngine/reports/previews_short/CILIC_FEDERER.pdf)

---


# GIG Reports

- Driven by `R` Markdown

- Automated with `Rscript`

- Multiple Reports for Media:
  - Player Profiles
  - Match Previews
  - Match Reviews
  
---

# Template

&lt;div style="float:center;margin-top:0%;" /&gt;
&lt;img src="report-script.png" width=95%&gt;
&lt;/div&gt;

---


[&lt;h1 style="margin-top:20%;margin-left:15%;"&gt;Demo: Match Report&lt;/h1&gt;](file:///Users/skovalchik/Software/GIGEngine/reports/matchreports_short/match_review_report_short.Rmd)


---

# Match Report Script


```r
library(rmarkdown)

options(warn = -1)

args &lt;- commandArgs(trailingOnly = TRUE)

arg1 &lt;- args[[1]]

arg2 &lt;- args[[2]]

arg3 &lt;- args[[3]]

arg4 &lt;- args[[4]]

rmarkdown::render("~/Software/GIGEngine/reports/matchreports_short/match_review_report_short.Rmd", params = list(player1 = arg4, player2 = arg3, matchid = arg1, filepath = arg2), output_file = paste(paste(gsub(" ", "_", arg3), gsub(" ", "_", arg4), sep = "_"), ".html", sep = "", collapse = ""), output_dir = "~/Software/GIGEngine/reports/matchreports_short/")
```

---


&lt;h1 style="margin-top:20%;margin-left:15%;"&gt;Demo: Report Automation&lt;/h1&gt;

---

# Tips: Real-time Rmarkdown

--

- Think of your document as a function

--

- Make your summaries &amp; plots generalizable

--

- Separate content from style with a CSS style sheet 


---

# Making an Application Robust

.pull-left[
- Test, test, test!

- Anticipate how things can go wrong and build that into your testing

- If you are not sure what could go wrong, run a representative group of input through the process and document what goes wrong
]

.pull-right[
![](lab.gif)
]

---

# Resources

- `Rscript`: https://stat.ethz.ch/R-manual/R-devel/library/utils/html/Rscript.html

- `lineprof`

- `datatable`

- Code Optimization: http://adv-r.had.co.nz/Performance.html

---

&lt;div style="float:center;margin-top:10%;" /&gt;
&lt;img src="closing.png" width=95%&gt;
&lt;/div&gt;
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
